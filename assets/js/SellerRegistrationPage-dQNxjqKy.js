import{j as e,C as s,F as a,B as r,L as t,A as l,P as i}from"./vendor-ui-Dyuh2GWT.js";import{a as n,c as d}from"./vendor-react-B8YbCJDS.js";import{y as o,u as c,z as m,e as u,f as p}from"./index-D3XXn1gU.js";import{b as x,h}from"./validation-C0j_3j3c.js";import"./vendor-leaflet-BYmSvtXk.js";import"./vendor-supabase-C9cCqp-Z.js";const j={name:"",description:"",address:"",location_lat:null,location_lng:null,products:[{name:"",description:"",price:"",image:null,imagePreview:null}]},g=({onSubmit:i,loading:d=!1})=>{const[c,m]=n.useState(j),[u,p]=n.useState({}),[g,f]=n.useState(!1),[b,v]=n.useState(null),[y,N]=n.useState(!1),w=e=>{const{name:s,value:a}=e.target;m((e=>({...e,[s]:a}))),"address"===s&&m((e=>({...e,location_lat:null,location_lng:null}))),y&&p((e=>({...e,[s]:null})))},F=(e,s,a)=>{m((r=>{const t=[...r.products];return t[e]={...t[e],[s]:a},{...r,products:t}})),y&&u.products&&p((a=>{const r=[...a.products||[]];return r[e]&&(r[e]={...r[e],[s]:null}),{...a,products:r}}))};return e.jsxs(s,{className:"max-w-3xl mx-auto",children:[e.jsx(s.Header,{children:e.jsx("h2",{className:"text-2xl font-display text-lemonade-blue-dark",children:"Register Your Lemonade Stand"})}),e.jsx(s.Body,{children:e.jsxs(a,{onSubmit:e=>{e.preventDefault(),N(!0);const s=x(c);if(p(s),h(s))return;const a={...c,products:c.products.map((e=>({name:e.name,description:e.description,price:parseFloat(e.price),image:e.image})))};i(a)},children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-display text-lemonade-pink-dark mb-4",children:"Seller Information"}),e.jsxs(a.Group,{children:[e.jsx(a.Label,{htmlFor:"name",required:!0,children:"Stand Name"}),e.jsx(a.Input,{id:"name",name:"name",value:c.name,onChange:w,placeholder:"Enter your lemonade stand name",error:u.name})]}),e.jsxs(a.Group,{children:[e.jsx(a.Label,{htmlFor:"description",children:"Stand Description"}),e.jsx(a.Textarea,{id:"description",name:"description",value:c.description,onChange:w,placeholder:"Describe your lemonade stand (optional)",rows:3,error:u.description}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional. Tell customers about your stand, its history, or what makes it special."})]}),e.jsxs(a.Group,{children:[e.jsx(a.Label,{htmlFor:"address",required:!0,children:"Address"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(a.Input,{id:"address",name:"address",value:c.address,onChange:w,placeholder:"Enter your stand's address",error:u.address})}),e.jsx(r,{type:"button",variant:"secondary",onClick:async()=>{if(c.address){f(!0),v(null);try{const e=await o(c.address);if(!e)return void v("Could not find coordinates for this address. Please try a different address.");m((s=>({...s,location_lat:e.lat,location_lng:e.lng}))),u.location&&p((e=>({...e,location:null})))}catch(e){v(e.message)}finally{f(!1)}}else v("Please enter an address first")},disabled:!c.address||g,className:"whitespace-nowrap",children:g?e.jsx(t,{size:"sm",variant:"white"}):"Geocode Address"})]}),b&&e.jsx(l,{variant:"error",className:"mt-2",children:b}),u.location&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:u.location}),c.location_lat&&c.location_lng&&e.jsxs("div",{className:"mt-2 p-2 bg-green-100 text-green-800 rounded-md text-sm",children:[e.jsx("span",{className:"font-semibold",children:"✓ Location verified:"})," ",c.location_lat.toFixed(6),", ",c.location_lng.toFixed(6)]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-display text-lemonade-pink-dark",children:"Products"}),c.products.length<2&&e.jsx(r,{type:"button",size:"sm",variant:"outline",onClick:()=>{c.products.length>=2||m((e=>({...e,products:[...e.products,{name:"",description:"",price:"",image:null,imagePreview:null}]})))},children:"Add Product"})]}),u.products&&!Array.isArray(u.products)&&e.jsx(l,{variant:"error",className:"mb-4",children:u.products}),c.products.map(((s,t)=>{var l,i,n,d;return e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"font-display text-lg",children:["Product ",t+1]}),c.products.length>1&&e.jsx(r,{type:"button",size:"sm",variant:"ghost",onClick:()=>(e=>{m((s=>({...s,products:s.products.filter(((s,a)=>a!==e))}))),u.products&&p((s=>({...s,products:s.products.filter(((s,a)=>a!==e))})))})(t),children:"Remove"})]}),e.jsxs(a.Group,{children:[e.jsx(a.Label,{htmlFor:`product-${t}-name`,required:!0,children:"Product Name"}),e.jsx(a.Input,{id:`product-${t}-name`,value:s.name,onChange:e=>F(t,"name",e.target.value),placeholder:"e.g., Classic Lemonade",error:u.products&&(null==(l=u.products[t])?void 0:l.name)})]}),e.jsxs(a.Group,{children:[e.jsx(a.Label,{htmlFor:`product-${t}-description`,required:!0,children:"Description"}),e.jsx(a.Textarea,{id:`product-${t}-description`,value:s.description,onChange:e=>F(t,"description",e.target.value),placeholder:"Describe your product...",rows:3,error:u.products&&(null==(i=u.products[t])?void 0:i.description)})]}),e.jsxs(a.Group,{children:[e.jsx(a.Label,{htmlFor:`product-${t}-price`,required:!0,children:"Price ($)"}),e.jsx(a.Input,{id:`product-${t}-price`,type:"number",min:"0.01",step:"0.01",value:s.price,onChange:e=>F(t,"price",e.target.value),placeholder:"0.00",error:u.products&&(null==(n=u.products[t])?void 0:n.price)})]}),e.jsxs(a.Group,{children:[e.jsx(a.Label,{htmlFor:`product-${t}-image`,children:"Product Image"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("input",{type:"file",id:`product-${t}-image`,accept:"image/*",onChange:e=>((e,s)=>{const a=s.target.files[0];if(!a)return;const r=new FileReader;r.onloadend=()=>{F(e,"imagePreview",r.result)},r.readAsDataURL(a),F(e,"image",a)})(t,e),className:"block w-full text-sm text-gray-500\n                          file:mr-4 file:py-2 file:px-4\n                          file:rounded-full file:border-0\n                          file:text-sm file:font-semibold\n                          file:bg-lemonade-blue-light file:text-lemonade-blue-dark\n                          hover:file:bg-lemonade-blue-dark hover:file:text-white\n                          file:cursor-pointer file:transition-colors"}),u.products&&(null==(d=u.products[t])?void 0:d.image)&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:u.products[t].image}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional. Max size: 5MB. Formats: JPEG, PNG, WebP"})]}),s.imagePreview&&e.jsxs("div",{className:"w-20 h-20 relative",children:[e.jsx("img",{src:s.imagePreview,alt:"Preview",className:"w-full h-full object-cover rounded-md"}),e.jsx("button",{type:"button",className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs",onClick:()=>{F(t,"image",null),F(t,"imagePreview",null)},children:"×"})]})]})]})]},t)}))]}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>{m(j),p({}),v(null),N(!1)},disabled:d,children:"Reset Form"}),e.jsx(r,{type:"submit",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(t,{size:"sm",variant:"white",className:"mr-2"}),"Submitting..."]}):"Register Stand"})]})]})})]})};g.propTypes={onSubmit:i.func.isRequired,loading:i.bool};const f=()=>{const[a,r]=n.useState(!1),[t,i]=n.useState(!1),[o,x]=n.useState(null),[h,j]=n.useState(null),{user:f}=c(),b=d();return e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-display text-lemonade-blue-dark mb-6",children:"Seller Registration"}),o&&e.jsx(l,{variant:"error",className:"mb-6",children:o}),t?e.jsxs("div",{className:"space-y-6",children:[e.jsx(l,{variant:"success",title:"Registration Successful!",children:"Your lemonade stand has been registered successfully. You can now manage your stand and products."}),e.jsxs(s,{children:[e.jsx(s.Header,{children:e.jsx("h2",{className:"text-xl font-display",children:"Registration Details"})}),e.jsx(s.Body,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Stand Information"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",h.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",h.address]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Location:"})," ",h.location_lat.toFixed(6),", ",h.location_lng.toFixed(6)]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Products"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-2",children:h.products.map(((a,r)=>e.jsxs(s,{variant:"yellow",className:"h-full",children:[e.jsx(s.Header,{children:e.jsx("h4",{className:"font-display",children:a.name})}),a.imagePreview&&e.jsx("img",{src:a.imagePreview,alt:a.name,className:"w-full h-40 object-cover"}),e.jsxs(s.Body,{children:[e.jsx("p",{className:"text-sm mb-2",children:a.description}),e.jsxs("p",{className:"font-bold text-lemonade-blue-dark",children:["$",parseFloat(a.price).toFixed(2)]})]})]},r)))})]})]})}),e.jsx(s.Footer,{children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{className:"px-4 py-2 bg-lemonade-yellow text-gray-800 rounded-lg font-display hover:bg-lemonade-yellow-dark transition-colors",onClick:()=>{i(!1),j(null)},children:"Register Another Stand"}),e.jsx("button",{className:"px-4 py-2 bg-lemonade-blue text-white rounded-lg font-display hover:bg-lemonade-blue-dark transition-colors",onClick:()=>b("/seller/dashboard"),children:"Go to Dashboard"})]})})]})]}):e.jsx(g,{onSubmit:async e=>{r(!0),x(null);try{const s={name:e.name,description:e.description||"",address:e.address,location_lat:e.location_lat,location_lng:e.location_lng,owner_id:f.id,is_active:!0},{data:a,error:r}=await m(s);if(r)throw new Error(`Failed to create stand: ${r.message}`);if(!a||0===a.length)throw new Error("Failed to create stand: No data returned");const t=a[0].id;for(const l of e.products){const e={name:l.name,description:l.description,price:parseFloat(l.price),stand_id:t,is_available:!0},{data:s,error:a}=await u(e);if(!a&&(l.image&&s&&s.length>0)){const e=s[0].id;await p(e,t,f.id,l.image)}}j(e),i(!0)}catch(s){x("Failed to register your stand. Please try again. "+s.message)}finally{r(!1)}},loading:a})]})};export{f as default};
//# sourceMappingURL=SellerRegistrationPage-dQNxjqKy.js.map
