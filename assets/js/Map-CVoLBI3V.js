import{j as e,P as o}from"./vendor-ui-Dyuh2GWT.js";import{a as r}from"./vendor-react-B8YbCJDS.js";import{M as n,T as t,Z as a,L as s,u as i,a as c,P as l}from"./vendor-leaflet-BYmSvtXk.js";import{c as u,i as d}from"./index-m5a3JCQu.js";s.Browser.safari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),s.Browser.iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,delete s.Icon.Default.prototype._getIconUrl,s.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const m=({center:e,zoom:o})=>{const n=i(),t=r.useRef(e),a=r.useRef(o);return r.useEffect((()=>{const r=e&&(!t.current||Math.abs(t.current[0]-e[0])>5e-4||Math.abs(t.current[1]-e[1])>5e-4),i=o!==a.current;if((r||i)&&e&&(n.setView(e,o,{animate:!0}),t.current=e,a.current=o),s.Browser.iOS){setTimeout((()=>{n.invalidateSize()}),100);n.getContainer().addEventListener("touchstart",(e=>{1===e.touches.length&&e.stopPropagation()}),{passive:!1})}}),[e,o,n]),null};m.propTypes={center:o.arrayOf(o.number),zoom:o.number};const g=r.memo((({showUserLocation:o,onUserLocationFound:n})=>{const[t,a]=r.useState(null),[m,g]=r.useState(null),p=i(),h=r.useRef(null),f=r.useRef(null),{location:x,getLocation:w}=u(),y=r.useMemo((()=>(()=>{const e=window.location.origin;return new s.Icon({iconUrl:`${e}/images/markers/user-location.svg`,iconSize:[24,24],iconAnchor:[12,12],popupAnchor:[0,-12]})})()),[]);return r.useEffect((()=>{if(x&&o){const e={lat:x.lat,lng:x.lng};a([e.lat,e.lng]),g(x.accuracy||0),h.current?(h.current.setLatLng(e),h.current.setRadius(x.accuracy||100)):h.current=s.circle(e,{radius:x.accuracy||100,color:"#4285F4",fillColor:"#4285F4",fillOpacity:.1,weight:1}).addTo(p)}}),[x,p,o]),r.useEffect((()=>{if(t&&n&&o){const e={lat:t[0],lng:t[1]};f.current||(f.current=e,n(e))}}),[t,o,n]),r.useEffect((()=>{if(o){if(d()){if(!x){p.locate({setView:!0,maxZoom:16,enableHighAccuracy:s.Browser.mobile,timeout:15e3,maximumAge:3e4,watch:s.Browser.mobile&&s.Browser.safari});const e=e=>{a([e.latlng.lat,e.latlng.lng]),g(e.accuracy),h.current?(h.current.setLatLng(e.latlng),h.current.setRadius(e.accuracy)):h.current=s.circle(e.latlng,{radius:e.accuracy,color:"#4285F4",fillColor:"#4285F4",fillOpacity:.1,weight:1}).addTo(p)},o=e=>{d()&&w()};return p.on("locationfound",e),p.on("locationerror",o),()=>{p.off("locationfound",e),p.off("locationerror",o)}}return()=>{h.current&&(h.current.remove(),h.current=null)}}}else h.current&&(h.current.remove(),h.current=null)}),[p,o,n,x,w]),t?e.jsx(c,{position:t,icon:y,children:e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-base",children:"Your Location"}),e.jsxs("p",{className:"text-sm",children:["Accuracy: ",Math.round(m)," meters"]})]})})}):null}));g.propTypes={showUserLocation:o.bool,onUserLocationFound:o.func};const p=r.memo((({stand:o,onStandClick:n})=>{const t=r.useMemo((()=>(()=>{const e=window.location.origin;return new s.Icon({iconUrl:`${e}/images/markers/lemonade-marker.svg`,iconSize:[40,48],iconAnchor:[20,48],popupAnchor:[0,-48]})})()),[]);return e.jsx(c,{position:[o.location_lat,o.location_lng],icon:t,eventHandlers:{click:()=>{n&&n(o)}},children:e.jsx(l,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-display text-lg text-lemonade-yellow-dark",children:o.name}),o.image_url&&e.jsx("img",{src:o.image_url,alt:o.name,className:"w-32 h-32 object-cover mx-auto my-2 rounded-lg",loading:"lazy"}),e.jsx("p",{className:"text-sm",children:o.description}),e.jsx("p",{className:"text-xs mt-2 text-gray-600",children:o.address}),e.jsx("button",{className:"mt-2 px-3 py-1 bg-lemonade-yellow text-gray-800 rounded-full text-sm font-display hover:bg-lemonade-yellow-dark",onClick:e=>{e.stopPropagation(),n&&n(o)},children:"View Details"})]})})},o.id)}));p.propTypes={stand:o.shape({id:o.string.isRequired,name:o.string.isRequired,description:o.string,location_lat:o.number.isRequired,location_lng:o.number.isRequired,address:o.string,image_url:o.string}).isRequired,onStandClick:o.func};const h=({stands:o=[],center:i=[49.2827,123.1207],zoom:c=13,height:l="500px",showUserLocation:u=!0,onStandClick:d,onUserLocationFound:h,className:f="",children:x,...w})=>{const y=r.useMemo((()=>o),[o]);return e.jsx("div",{className:`rounded-xl overflow-hidden shadow-playful lemonade-map-container ${f}`,style:{height:l},...w,children:e.jsxs(n,{center:i,zoom:c,style:{height:"100%",width:"100%"},zoomControl:!1,preferCanvas:!0,attributionControl:!1,minZoom:2,maxZoom:50,updateWhenZooming:!1,updateWhenIdle:!0,tap:!0,dragging:(s.Browser.mobile,!0),touchZoom:!0,doubleClickZoom:!0,scrollWheelZoom:!0,keyboard:!0,bounceAtZoomLimits:!1,tapTolerance:15,wheelDebounceTime:100,children:[e.jsx(t,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(a,{position:"bottomright"}),e.jsx(m,{center:i,zoom:c}),e.jsx(g,{showUserLocation:u,onUserLocationFound:h}),y.map((o=>e.jsx(p,{stand:o,onStandClick:d},o.id))),x]})})};h.propTypes={stands:o.arrayOf(o.shape({id:o.string.isRequired,name:o.string.isRequired,description:o.string,location_lat:o.number.isRequired,location_lng:o.number.isRequired,address:o.string,image_url:o.string})),center:o.arrayOf(o.number),zoom:o.number,height:o.string,showUserLocation:o.bool,onStandClick:o.func,onUserLocationFound:o.func,className:o.string,children:o.node};export{h as M};
//# sourceMappingURL=Map-CVoLBI3V.js.map
