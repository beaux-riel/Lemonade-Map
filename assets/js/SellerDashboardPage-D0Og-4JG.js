import{j as e,A as a,T as s,B as l,C as t,M as i,F as r}from"./vendor-ui-CYdTg3fb.js";import{a as n,L as d}from"./vendor-react-CGzs7eOH.js";import{u as c,g as o,a as m,b as u}from"./index-CnSm_wUu.js";import"./vendor-leaflet-DNyTttW1.js";import"./vendor-supabase-CS0gIFIa.js";const x=()=>{const{user:x}=c(),[h,p]=n.useState([]),[b,j]=n.useState([]),[v,g]=n.useState(!0),[y,f]=n.useState(null),[N,w]=n.useState(null),[_,S]=n.useState("stands"),[k,C]=n.useState(null),[$,F]=n.useState(null),[P,E]=n.useState({name:"",description:"",price:"",is_available:!0}),[Y,D]=n.useState(!1);n.useEffect((()=>{(async()=>{try{g(!0);const{data:e,error:a}=await o(x.id);if(a)throw new Error(a.message);if(p(e||[]),e&&e.length>0){const a=e.map((e=>e.id)),s=[];for(const l of a){const{data:a,error:t}=await m(l);if(!t&&(a&&a.length>0)){const l=a.map((a=>{var s;return{...a,stand_name:(null==(s=e.find((e=>e.id===a.stand_id)))?void 0:s.name)||"Unknown Stand"}}));s.push(...l)}}j(s)}}catch(e){f("Failed to load your data. Please try again.")}finally{g(!1)}})()}),[x.id]);const I=e=>{const{name:a,value:s,type:l,checked:t}=e.target;E((e=>({...e,[a]:"checkbox"===l?t:s})))};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-display text-lemonade-blue-dark mb-2",children:"Seller Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Manage your lemonade stands and products"})]}),y&&e.jsx(a,{variant:"error",className:"mb-6",dismissible:!0,onDismiss:()=>f(null),children:y}),N&&e.jsx(a,{variant:"success",className:"mb-6",dismissible:!0,onDismiss:()=>w(null),children:N}),e.jsxs(s,{defaultTab:"products"===_?1:0,onChange:e=>S(0===e?"stands":"products"),className:"mb-6",children:[e.jsx(s.Item,{children:"My Stands"}),e.jsx(s.Item,{children:"My Products"}),e.jsx(s.Panel,{children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-display text-lemonade-blue-dark",children:"Your Lemonade Stands"}),e.jsx(d,{to:"/seller/stands/new",children:e.jsx(l,{variant:"primary",children:"Add New Stand"})})]}),v?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-lemonade-blue"})}):0===h.length?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"You don't have any lemonade stands yet."}),e.jsx(d,{to:"/seller/stands/new",children:e.jsx(l,{variant:"primary",children:"Create Your First Stand"})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map((a=>e.jsxs("div",{className:"border rounded-lg overflow-hidden hover:shadow-md transition",children:[a.image_url?e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-48 object-cover"}):e.jsx("div",{className:"w-full h-48 bg-lemonade-yellow-light flex items-center justify-center",children:e.jsx("span",{className:"text-lemonade-yellow-dark",children:"No Image"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-xl font-display text-lemonade-blue-dark mb-2",children:a.name}),e.jsx("p",{className:"text-gray-600 mb-3 line-clamp-2",children:a.description||"No description"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+(a.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:a.is_active?"Active":"Inactive"}),e.jsx(d,{to:`/seller/stands/${a.id}`,className:"text-lemonade-blue hover:underline",onClick:e=>{a.id||(e.preventDefault(),f("Cannot manage this stand: Stand ID is missing"))},state:{standData:a},children:"Manage →"})]})]})]},a.id)))})]})}),e.jsx(s.Panel,{children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-display text-lemonade-blue-dark",children:"Your Products"}),h.length>0&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("select",{className:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-lemonade-blue",onChange:e=>{e.target.value&&(window.location.href=`/seller/stands/${e.target.value}/products/new`)},defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a stand..."}),h.map((a=>e.jsx("option",{value:a.id,children:a.name},a.id)))]}),e.jsx(l,{variant:"primary",onClick:()=>{const e=document.querySelector("select");e.value?window.location.href=`/seller/stands/${e.value}/products/new`:alert("Please select a stand first")},children:"Add New Product"})]})]}),v?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-lemonade-blue"})}):0===b.length?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:0===h.length?"You need to create a stand before adding products.":"You don't have any products yet."}),0===h.length?e.jsx(d,{to:"/seller/stands/new",children:e.jsx(l,{variant:"primary",children:"Create Your First Stand"})}):e.jsx(d,{to:`/seller/stands/${h[0].id}/products/new`,children:e.jsx(l,{variant:"primary",children:"Add Your First Product"})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map((a=>e.jsxs(t,{className:"hover:shadow-md transition",children:[e.jsx("div",{className:"h-48 bg-gray-100",children:a.image_url?e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-lemonade-yellow-light flex items-center justify-center",children:e.jsx("span",{className:"text-lemonade-yellow-dark",children:"No Image"})})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-xl font-display text-lemonade-blue-dark mb-1",children:a.name}),e.jsx("p",{className:"text-sm text-lemonade-blue mb-2",children:a.stand_name}),e.jsx("p",{className:"text-gray-600 mb-2 line-clamp-2",children:a.description||"No description"}),e.jsxs("p",{className:"text-lg font-semibold text-lemonade-blue-dark mb-3",children:["$",parseFloat(a.price).toFixed(2)]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:()=>(async e=>{D(!0);try{const{data:a,error:s}=await u(e.id,{is_available:!e.is_available});if(s)throw new Error(s.message);j((a=>a.map((a=>a.id===e.id?{...a,is_available:!a.is_available}:a)))),w(`Product "${e.name}" is now ${e.is_available?"unavailable":"available"}`),setTimeout((()=>w(null)),3e3)}catch(a){f(`Failed to update product: ${a.message}`)}finally{D(!1)}})(a),disabled:Y,className:"px-2 py-1 rounded-full text-xs cursor-pointer hover:opacity-80 "+(a.is_available?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:a.is_available?"Available":"Unavailable"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>(e=>{F(e),E({price:e.price,is_available:e.is_available})})(a),className:"text-lemonade-blue hover:underline",disabled:Y,children:"Quick Edit"}),e.jsx(d,{to:`/seller/stands/${a.stand_id}/products/${a.id}`,className:"text-lemonade-blue hover:underline",children:"Full Edit →"})]})]})]})]},a.id)))})]})})]}),$&&e.jsx(i,{isOpen:!!$,onClose:()=>F(null),title:`Quick Edit: ${$.name}`,children:e.jsxs("div",{className:"p-6",children:[e.jsxs(r,{onSubmit:e=>{e.preventDefault(),(async()=>{if($){D(!0);try{const e=parseFloat(P.price);if(isNaN(e)||e<=0)throw new Error("Please enter a valid price");const{data:a,error:s}=await u($.id,{price:e,is_available:P.is_available});if(s)throw new Error(s.message);j((a=>a.map((a=>a.id===$.id?{...a,price:e,is_available:P.is_available}:a)))),w(`Product "${$.name}" updated successfully`),setTimeout((()=>w(null)),3e3),F(null)}catch(e){f(`Failed to update product: ${e.message}`)}finally{D(!1)}}})()},children:[e.jsxs(r.Group,{children:[e.jsx(r.Label,{htmlFor:"price",required:!0,children:"Price ($)"}),e.jsx(r.Input,{id:"price",name:"price",type:"number",step:"0.01",min:"0.01",value:P.price,onChange:I,placeholder:"Enter price",required:!0})]}),e.jsxs(r.Group,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(r.Checkbox,{id:"is_available",name:"is_available",checked:P.is_available,onChange:I}),e.jsx(r.Label,{htmlFor:"is_available",className:"ml-2 mb-0",children:"Product is available"})]}),e.jsx(r.Text,{children:"Unavailable products are not shown to customers."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx(l,{type:"button",variant:"secondary",onClick:()=>F(null),disabled:Y,children:"Cancel"}),e.jsx(l,{type:"submit",variant:"primary",disabled:Y,children:Y?"Saving...":"Save Changes"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Need to make more changes? ",e.jsx(d,{to:`/seller/stands/${$.stand_id}/products/${$.id}`,className:"text-lemonade-blue hover:underline",children:"Go to full edit page"})]})})]})})]})};export{x as default};
//# sourceMappingURL=SellerDashboardPage-D0Og-4JG.js.map
