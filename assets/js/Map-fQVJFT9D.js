import{j as e,i as o}from"./vendor-ui-CYdTg3fb.js";import{a as n}from"./vendor-react-CGzs7eOH.js";import{M as t,T as r,Z as a,L as s,u as i,a as l,P as c}from"./vendor-leaflet-DNyTttW1.js";import{v as u,x as d}from"./index-C8mM50Ec.js";s.Browser.safari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),s.Browser.iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,delete s.Icon.Default.prototype._getIconUrl,s.Icon.Default.mergeOptions({iconRetinaUrl:null,iconUrl:null,shadowUrl:null});const m=({center:e,zoom:o})=>{const t=i();return n.useEffect((()=>{if(e&&t.setView(e,o),s.Browser.iOS){setTimeout((()=>{t.invalidateSize()}),100);t.getContainer().addEventListener("touchstart",(e=>{1===e.touches.length&&e.stopPropagation()}),{passive:!1})}}),[e,o,t]),null};m.propTypes={center:o.arrayOf(o.number),zoom:o.number};const g=n.memo((({showUserLocation:o,onUserLocationFound:t})=>{const[r,a]=n.useState(null),[m,g]=n.useState(null),p=i(),h=n.useRef(null),f=n.useRef(null),{location:x,getLocation:y}=u(),w=n.useMemo((()=>new s.Icon({iconUrl:"/images/markers/user-location.svg",iconSize:[24,24],iconAnchor:[12,12],popupAnchor:[0,-12]})),[]);return n.useEffect((()=>{if(x&&o){const e={lat:x.lat,lng:x.lng};a([e.lat,e.lng]),g(x.accuracy||0),h.current?(h.current.setLatLng(e),h.current.setRadius(x.accuracy||100)):h.current=s.circle(e,{radius:x.accuracy||100,color:"#4285F4",fillColor:"#4285F4",fillOpacity:.1,weight:1}).addTo(p)}}),[x,p,o]),n.useEffect((()=>{if(r&&t&&o){const e={lat:r[0],lng:r[1]};(!f.current||Math.abs(f.current.lat-e.lat)>1e-4||Math.abs(f.current.lng-e.lng)>1e-4)&&(f.current=e,t(e))}}),[r,o,t]),n.useEffect((()=>{if(o){if(d()){if(!x){p.locate({setView:!0,maxZoom:16,enableHighAccuracy:s.Browser.mobile,timeout:15e3,maximumAge:3e4,watch:s.Browser.mobile&&s.Browser.safari});const e=e=>{a([e.latlng.lat,e.latlng.lng]),g(e.accuracy),h.current?(h.current.setLatLng(e.latlng),h.current.setRadius(e.accuracy)):h.current=s.circle(e.latlng,{radius:e.accuracy,color:"#4285F4",fillColor:"#4285F4",fillOpacity:.1,weight:1}).addTo(p)},o=e=>{d()&&y()};return p.on("locationfound",e),p.on("locationerror",o),()=>{p.off("locationfound",e),p.off("locationerror",o)}}return()=>{h.current&&(h.current.remove(),h.current=null)}}}else h.current&&(h.current.remove(),h.current=null)}),[p,o,t,x,y]),r?e.jsx(l,{position:r,icon:w,children:e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-base",children:"Your Location"}),e.jsxs("p",{className:"text-sm",children:["Accuracy: ",Math.round(m)," meters"]})]})})}):null}));g.propTypes={showUserLocation:o.bool,onUserLocationFound:o.func};const p=n.memo((({stand:o,onStandClick:t})=>{const r=n.useMemo((()=>new s.Icon({iconUrl:"/images/markers/lemonade-marker.svg",iconSize:[40,48],iconAnchor:[20,48],popupAnchor:[0,-48]})),[]);return e.jsx(l,{position:[o.location_lat,o.location_lng],icon:r,eventHandlers:{click:()=>{t&&t(o)}},children:e.jsx(c,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-display text-lg text-lemonade-yellow-dark",children:o.name}),o.image_url&&e.jsx("img",{src:o.image_url,alt:o.name,className:"w-32 h-32 object-cover mx-auto my-2 rounded-lg",loading:"lazy"}),e.jsx("p",{className:"text-sm",children:o.description}),e.jsx("p",{className:"text-xs mt-2 text-gray-600",children:o.address}),e.jsx("button",{className:"mt-2 px-3 py-1 bg-lemonade-yellow text-gray-800 rounded-full text-sm font-display hover:bg-lemonade-yellow-dark",onClick:e=>{e.stopPropagation(),t&&t(o)},children:"View Details"})]})})},o.id)}));p.propTypes={stand:o.shape({id:o.string.isRequired,name:o.string.isRequired,description:o.string,location_lat:o.number.isRequired,location_lng:o.number.isRequired,address:o.string,image_url:o.string}).isRequired,onStandClick:o.func};const h=({stands:o=[],center:i=[49.2827,123.1207],zoom:l=13,height:c="500px",showUserLocation:u=!0,onStandClick:d,onUserLocationFound:h,className:f="",...x})=>{const y=n.useMemo((()=>o),[o]);return e.jsx("div",{className:`rounded-xl overflow-hidden shadow-playful lemonade-map-container ${f}`,style:{height:c},...x,children:e.jsxs(t,{center:i,zoom:l,style:{height:"100%",width:"100%"},zoomControl:!1,preferCanvas:!0,attributionControl:!1,minZoom:2,maxZoom:50,updateWhenZooming:!1,updateWhenIdle:!0,tap:!0,dragging:(s.Browser.mobile,!0),touchZoom:!0,doubleClickZoom:!0,scrollWheelZoom:!0,keyboard:!0,bounceAtZoomLimits:!1,tapTolerance:15,wheelDebounceTime:100,children:[e.jsx(r,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(a,{position:"bottomright"}),e.jsx(m,{center:i,zoom:l}),e.jsx(g,{showUserLocation:u,onUserLocationFound:h}),y.map((o=>e.jsx(p,{stand:o,onStandClick:d},o.id)))]})})};h.propTypes={stands:o.arrayOf(o.shape({id:o.string.isRequired,name:o.string.isRequired,description:o.string,location_lat:o.number.isRequired,location_lng:o.number.isRequired,address:o.string,image_url:o.string})),center:o.arrayOf(o.number),zoom:o.number,height:o.string,showUserLocation:o.bool,onStandClick:o.func,onUserLocationFound:o.func,className:o.string};export{h as M};
//# sourceMappingURL=Map-fQVJFT9D.js.map
