import{j as e,L as a,C as l,b as s,A as r,T as t,F as n,B as i,c as o}from"./vendor-ui-Dyuh2GWT.js";import{c as u,a as d}from"./vendor-react-B8YbCJDS.js";import{H as c}from"./Helmet-BqWDgRGe.js";import{u as m,j as h,k as b,l as v,m as p,n as x}from"./index-C0qHiaMe.js";import{v as j,a as f}from"./validation-C0j_3j3c.js";import"./vendor-leaflet-BYmSvtXk.js";import"./vendor-supabase-C9cCqp-Z.js";const g=[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"},{value:"DC",label:"District of Columbia"}],y=[{value:"United States",label:"United States"},{value:"Canada",label:"Canada"},{value:"Mexico",label:"Mexico"},{value:"United Kingdom",label:"United Kingdom"},{value:"Australia",label:"Australia"},{value:"Other",label:"Other"}],N=[{value:"AB",label:"Alberta"},{value:"BC",label:"British Columbia"},{value:"MB",label:"Manitoba"},{value:"NB",label:"New Brunswick"},{value:"NL",label:"Newfoundland and Labrador"},{value:"NS",label:"Nova Scotia"},{value:"NT",label:"Northwest Territories"},{value:"NU",label:"Nunavut"},{value:"ON",label:"Ontario"},{value:"PE",label:"Prince Edward Island"},{value:"QC",label:"Quebec"},{value:"SK",label:"Saskatchewan"},{value:"YT",label:"Yukon"}],w=[{value:"ACT",label:"Australian Capital Territory"},{value:"NSW",label:"New South Wales"},{value:"NT",label:"Northern Territory"},{value:"QLD",label:"Queensland"},{value:"SA",label:"South Australia"},{value:"TAS",label:"Tasmania"},{value:"VIC",label:"Victoria"},{value:"WA",label:"Western Australia"}],C=()=>{const{user:C,isAuthenticated:S}=m(),A=u(),[M,L]=d.useState("personal"),[_,I]=d.useState(!0),[F,T]=d.useState(!1),[k,P]=d.useState(null),[z,G]=d.useState(null),[D,B]=d.useState(null),[E,O]=d.useState(null),[W,U]=d.useState(null),[Y,H]=d.useState(null),[K,V]=d.useState({full_name:"",email:"",phone:"",bio:""}),[R,Q]=d.useState({street:"",city:"",state:"",postalCode:"",country:"Canada",apt_suite:"",address_line2:"",useForSearch:!1}),J=(e=>{switch(e){case"United States":return g;case"Canada":return N;case"Australia":return w;default:return[]}})(R.country),[Z,q]=d.useState({}),[X,$]=d.useState({});d.useEffect((()=>{if(!S)return void A("/login",{state:{from:"/profile"}});(async()=>{var e,a;try{I(!0);const{data:l,error:s}=await h(C.id);if(s)throw new Error(s.message);l&&(V({full_name:l.full_name||"",email:C.email||"",phone:l.phone||"",bio:l.bio||""}),Q({street:l.street||"",city:l.city||"",state:l.state||"",postalCode:l.postal_code||"",country:l.country||"Canada",apt_suite:l.apt_suite||"",address_line2:l.address_line2||"",useForSearch:(null==(a=null==(e=l.preferences)?void 0:e.defaultSearchLocation)?void 0:a.useForSearch)||!1}),l.avatar_url&&H(l.avatar_url))}catch(l){P(l.message)}finally{I(!1)}})()}),[S,A,C]);const ee=e=>{const{name:a,value:l}=e.target;V((e=>({...e,[a]:l}))),Z[a]&&q((e=>({...e,[a]:null})))},ae=e=>{const{name:a,value:l}=e.target;Q((e=>({...e,[a]:l}))),X[a]&&$((e=>({...e,[a]:null})))};return _?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(a,{size:"lg",variant:"yellow",message:"Loading your profile..."})}):e.jsxs("div",{className:"py-12 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-lemonade-yellow-light to-white",children:[e.jsxs(c,{children:[e.jsx("title",{children:"My Profile | Lemonade Map"}),e.jsx("meta",{name:"description",content:"Update your Lemonade Map profile and preferences"})]}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-display text-lemonade-blue-dark mb-4",children:"My Lemonade Profile"}),e.jsx("div",{className:"w-24 h-2 bg-lemonade-yellow mx-auto rounded-full mb-6"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Customize your profile and preferences to get the most out of your Lemonade Map experience!"})]}),e.jsxs(l,{className:"shadow-playful-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-lemonade-blue-light p-6 flex flex-col items-center",children:[e.jsxs("div",{className:"relative group",children:[e.jsx(s,{src:Y,alt:K.full_name||"User",size:"xl",className:"border-4 border-white shadow-lg"}),e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:[e.jsx("label",{htmlFor:"avatar-upload",className:"text-white text-sm font-medium cursor-pointer",children:"Change"}),e.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",className:"hidden",onChange:e=>{const a=e.target.files[0];if(!a)return;if(!["image/jpeg","image/png","image/gif","image/webp"].includes(a.type))return void P("Please upload a valid image file (JPEG, PNG, GIF, or WebP)");if(a.size>5242880)return void P("Image file is too large. Maximum size is 5MB.");const l=new FileReader;l.onloadend=()=>{H(l.result)},l.readAsDataURL(a),U(a),P(null)}})]})]}),e.jsx("h2",{className:"mt-4 text-2xl font-display text-lemonade-blue-dark",children:K.full_name||"Your Profile"}),e.jsx("p",{className:"text-lemonade-blue-dark opacity-75",children:K.email})]}),e.jsxs(l.Body,{className:"px-6 pt-4",children:[k&&e.jsx(r,{type:"error",message:k,className:"mb-6",onClose:()=>P(null)}),z&&e.jsx(r,{type:"success",message:z,className:"mb-6",onClose:()=>G(null)}),e.jsxs(t,{defaultTab:"address"===M?1:0,onChange:e=>{L(0===e?"personal":"address"),P(null),G(null),B(null),O(null)},className:"mb-6",children:[e.jsx(t.Item,{children:"Personal Info"}),e.jsx(t.Item,{children:"Address"}),e.jsx(t.Panel,{children:e.jsx(n,{onSubmit:async e=>{e.preventDefault();const a=j(K);if(q(a),!(Object.keys(a).length>0))try{T(!0),P(null),G(null);const{error:e}=await b(C.id,{full_name:K.full_name,phone:K.phone,bio:K.bio});if(e)throw new Error(e.message);if(W){const{error:e}=await v(C.id,W);if(e)throw new Error(e.message)}G("Profile updated successfully!"),U(null)}catch(l){P(l.message)}finally{T(!1)}},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"full_name",required:!0,children:"Full Name"}),e.jsx(n.Input,{id:"full_name",name:"full_name",value:K.full_name,onChange:ee,placeholder:"Your full name",error:Z.full_name})]}),e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"email",children:"Email Address"}),e.jsx(n.Input,{id:"email",name:"email",type:"email",value:K.email,disabled:!0,className:"bg-gray-100"}),e.jsx(n.Text,{children:"Email cannot be changed. Contact support if needed."})]}),e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"phone",children:"Phone Number"}),e.jsx(n.Input,{id:"phone",name:"phone",value:K.phone,onChange:ee,placeholder:"Your phone number (optional)",error:Z.phone})]}),e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"bio",children:"Bio"}),e.jsx(n.Textarea,{id:"bio",name:"bio",value:K.bio,onChange:ee,placeholder:"Tell us a bit about yourself...",rows:4,error:Z.bio})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(i,{type:"submit",variant:"primary",size:"lg",disabled:F,children:F?e.jsxs(e.Fragment,{children:[e.jsx(a,{size:"sm",variant:"white",className:"mr-2"}),"Saving..."]}):"Save Profile"})})]})})}),e.jsxs(t.Panel,{children:[D&&e.jsx(r,{type:"error",message:D,className:"mb-6",onClose:()=>B(null)}),E&&e.jsx(r,{type:"success",message:E,className:"mb-6",onClose:()=>O(null)}),e.jsx(n,{onSubmit:async e=>{e.preventDefault();const a=f(R);if($(a),!(Object.keys(a).length>0))try{T(!0),B(null),O(null);const{data:e,error:a}=await p(C.id,R);if(a)throw new Error(a.message);const l={defaultSearchLocation:{useForSearch:R.useForSearch}},{error:s}=await x(C.id,l);if(s)throw new Error(s.message);O("Address and preferences updated successfully!")}catch(l){B(l.message)}finally{T(!1)}},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"street",children:"Street Address"}),e.jsx(n.Input,{id:"street",name:"street",value:R.street,onChange:ae,placeholder:"123 Main St",error:X.street})]}),e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"apt_suite",children:"Apartment/Suite"}),e.jsx(n.Input,{id:"apt_suite",name:"apt_suite",value:R.apt_suite,onChange:ae,placeholder:"Apt 4B",error:X.apt_suite})]}),e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"address_line2",children:"Address Line 2"}),e.jsx(n.Input,{id:"address_line2",name:"address_line2",value:R.address_line2,onChange:ae,placeholder:"Building name, Floor, etc.",error:X.address_line2})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"city",children:"City"}),e.jsx(n.Input,{id:"city",name:"city",value:R.city,onChange:ae,placeholder:"Your city",error:X.city})]}),e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"state",children:"State/Province"}),e.jsx(n.Select,{id:"state",name:"state",value:R.state,onChange:ae,options:J,placeholder:"Select state/province",error:X.state})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"postalCode",children:"ZIP/Postal Code"}),e.jsx(n.Input,{id:"postalCode",name:"postalCode",value:R.postalCode,onChange:ae,placeholder:"12345",error:X.postalCode})]}),e.jsxs(n.Group,{children:[e.jsx(n.Label,{htmlFor:"country",children:"Country"}),e.jsx(n.Select,{id:"country",name:"country",value:R.country,onChange:ae,options:y,error:X.country})]})]}),e.jsx("div",{className:"bg-lemonade-yellow-light p-4 rounded-lg border border-lemonade-yellow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-lemonade-blue-dark text-lg",children:"Use as Default Search Location"}),e.jsx("p",{className:"text-sm text-gray-600",children:"When enabled, we'll use this address as your default location when searching for lemonade stands."})]}),e.jsx(o,{checked:R.useForSearch,onChange:e=>{Q((a=>({...a,useForSearch:e})))},label:"",srLabel:"Use address as default search location"})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(i,{type:"submit",variant:"primary",size:"lg",disabled:F,children:F?e.jsxs(e.Fragment,{children:[e.jsx(a,{size:"sm",variant:"white",className:"mr-2"}),"Saving..."]}):"Save Address"})})]})})]})]})]})]}),e.jsxs("div",{className:"relative mt-12",children:[e.jsx("div",{className:"absolute -top-16 -left-8 w-16 h-16 text-lemonade-yellow opacity-30 transform rotate-12",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h10v2H7z"})})}),e.jsx("div",{className:"absolute -bottom-8 -right-8 w-20 h-20 text-lemonade-pink opacity-20 transform -rotate-12",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h10v2H7z"})})})]})]})]})};export{C as default};
//# sourceMappingURL=ProfilePage-BO2Q20K3.js.map
